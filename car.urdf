<?xml version="1.0" ?>
<!--
    URDF for Raspberry Pi 4WD Autonomous RC Car
    
    Robot Structure:
    - Chassis: Main body
    - Wheels: 4 DC motors (front-left, front-right, rear-left, rear-right)
    - Sensors: Front/Rear Sonar (HC-SR04), IR sensors, MPU-6050 IMU, Camera
    - Computing: Raspberry Pi 3B+
    - Motor Drivers: 2x L298N
-->
<robot name="rpi_rc_car">
  
  <!-- ===== ROBOT BASE (CHASSIS) ===== -->
  <link name="base_link">
    <inertial>
      <mass value="2.5"/>
      <origin xyz="0 0 0.05"/>
      <inertia ixx="0.02" ixy="0.0" ixz="0.0" iyy="0.02" iyz="0.0" izz="0.04"/>
    </inertial>
    
    <collision>
      <origin xyz="0 0 0.05" rpy="0 0 0"/>
      <geometry>
        <box size="0.20 0.12 0.08"/>
      </geometry>
    </collision>
    
    <visual>
      <origin xyz="0 0 0.05" rpy="0 0 0"/>
      <geometry>
        <box size="0.20 0.12 0.08"/>
      </geometry>
      <material name="chassis_color">
        <color rgba="0.2 0.2 0.2 1.0"/>
      </material>
    </visual>
  </link>
  
  <!-- ===== WHEELS ===== -->
  
  <!-- Front Left Wheel -->
  <link name="wheel_front_left">
    <inertial>
      <mass value="0.2"/>
      <origin xyz="0 0 0"/>
      <inertia ixx="0.0006" ixy="0.0" ixz="0.0" iyy="0.0006" iyz="0.0" izz="0.001"/>
    </inertial>
    
    <collision>
      <origin xyz="0 0 0" rpy="${pi/2} 0 0"/>
      <geometry>
        <cylinder radius="0.033" length="0.030"/>
      </geometry>
    </collision>
    
    <visual>
      <origin xyz="0 0 0" rpy="${pi/2} 0 0"/>
      <geometry>
        <cylinder radius="0.033" length="0.030"/>
      </geometry>
      <material name="wheel_color">
        <color rgba="0.3 0.3 0.3 1.0"/>
      </material>
    </visual>
  </link>
  
  <!-- Front Left Wheel Joint -->
  <joint name="wheel_front_left_joint" type="continuous">
    <parent link="base_link"/>
    <child link="wheel_front_left"/>
    <origin xyz="0.065 0.070 0.025" rpy="0 0 0"/>
    <axis xyz="0 1 0"/>
    <limit effort="5.0" velocity="20.0"/>
  </joint>
  
  <!-- Front Right Wheel -->
  <link name="wheel_front_right">
    <inertial>
      <mass value="0.2"/>
      <origin xyz="0 0 0"/>
      <inertia ixx="0.0006" ixy="0.0" ixz="0.0" iyy="0.0006" iyz="0.0" izz="0.001"/>
    </inertial>
    
    <collision>
      <origin xyz="0 0 0" rpy="${pi/2} 0 0"/>
      <geometry>
        <cylinder radius="0.033" length="0.030"/>
      </geometry>
    </collision>
    
    <visual>
      <origin xyz="0 0 0" rpy="${pi/2} 0 0"/>
      <geometry>
        <cylinder radius="0.033" length="0.030"/>
      </geometry>
      <material name="wheel_color">
        <color rgba="0.3 0.3 0.3 1.0"/>
      </material>
    </visual>
  </link>
  
  <!-- Front Right Wheel Joint -->
  <joint name="wheel_front_right_joint" type="continuous">
    <parent link="base_link"/>
    <child link="wheel_front_right"/>
    <origin xyz="0.065 -0.070 0.025" rpy="0 0 0"/>
    <axis xyz="0 1 0"/>
    <limit effort="5.0" velocity="20.0"/>
  </joint>
  
  <!-- Rear Left Wheel -->
  <link name="wheel_rear_left">
    <inertial>
      <mass value="0.2"/>
      <origin xyz="0 0 0"/>
      <inertia ixx="0.0006" ixy="0.0" ixz="0.0" iyy="0.0006" iyz="0.0" izz="0.001"/>
    </inertial>
    
    <collision>
      <origin xyz="0 0 0" rpy="${pi/2} 0 0"/>
      <geometry>
        <cylinder radius="0.033" length="0.030"/>
      </geometry>
    </collision>
    
    <visual>
      <origin xyz="0 0 0" rpy="${pi/2} 0 0"/>
      <geometry>
        <cylinder radius="0.033" length="0.030"/>
      </geometry>
      <material name="wheel_color">
        <color rgba="0.3 0.3 0.3 1.0"/>
      </material>
    </visual>
  </link>
  
  <!-- Rear Left Wheel Joint -->
  <joint name="wheel_rear_left_joint" type="continuous">
    <parent link="base_link"/>
    <child link="wheel_rear_left"/>
    <origin xyz="-0.065 0.070 0.025" rpy="0 0 0"/>
    <axis xyz="0 1 0"/>
    <limit effort="5.0" velocity="20.0"/>
  </joint>
  
  <!-- Rear Right Wheel -->
  <link name="wheel_rear_right">
    <inertial>
      <mass value="0.2"/>
      <origin xyz="0 0 0"/>
      <inertia ixx="0.0006" ixy="0.0" ixz="0.0" iyy="0.0006" iyz="0.0" izz="0.001"/>
    </inertial>
    
    <collision>
      <origin xyz="0 0 0" rpy="${pi/2} 0 0"/>
      <geometry>
        <cylinder radius="0.033" length="0.030"/>
      </geometry>
    </collision>
    
    <visual>
      <origin xyz="0 0 0" rpy="${pi/2} 0 0"/>
      <geometry>
        <cylinder radius="0.033" length="0.030"/>
      </geometry>
      <material name="wheel_color">
        <color rgba="0.3 0.3 0.3 1.0"/>
      </material>
    </visual>
  </link>
  
  <!-- Rear Right Wheel Joint -->
  <joint name="wheel_rear_right_joint" type="continuous">
    <parent link="base_link"/>
    <child link="wheel_rear_right"/>
    <origin xyz="-0.065 -0.070 0.025" rpy="0 0 0"/>
    <axis xyz="0 1 0"/>
    <limit effort="5.0" velocity="20.0"/>
  </joint>
  
  <!-- ===== SENSORS ===== -->
  
  <!-- Laser Scanner Servo Base (fixed to chassis) -->
  <link name="laser_servo_base">
    <inertial>
      <mass value="0.010"/>
      <origin xyz="0 0 0"/>
      <inertia ixx="0.000001" ixy="0.0" ixz="0.0" iyy="0.000001" iyz="0.0" izz="0.000001"/>
    </inertial>
    
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <box size="0.023 0.012 0.022"/>
      </geometry>
      <material name="servo_color">
        <color rgba="0.15 0.15 0.6 1.0"/>
      </material>
    </visual>
  </link>
  
  <!-- Servo Base Joint (fixed to front of chassis) -->
  <joint name="laser_servo_base_joint" type="fixed">
    <parent link="base_link"/>
    <child link="laser_servo_base"/>
    <origin xyz="0.095 0 0.08" rpy="0 0 0"/>
  </joint>
  
  <!-- VL53L0X Laser Sensor (rotates on servo, ±60°) -->
  <link name="laser_scanner">
    <inertial>
      <mass value="0.005"/>
      <origin xyz="0 0 0"/>
      <inertia ixx="0.0000001" ixy="0.0" ixz="0.0" iyy="0.0000001" iyz="0.0" izz="0.0000001"/>
    </inertial>
    
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <box size="0.012 0.012 0.005"/>
      </geometry>
    </collision>
    
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <box size="0.012 0.012 0.005"/>
      </geometry>
      <material name="laser_color">
        <color rgba="0.9 0.2 0.2 1.0"/>
      </material>
    </visual>
  </link>
  
  <!-- Laser Scanner Revolute Joint (yaw ±60°, controlled by servo GPIO 21) -->
  <joint name="laser_scanner_joint" type="revolute">
    <parent link="laser_servo_base"/>
    <child link="laser_scanner"/>
    <origin xyz="0 0 0.015" rpy="0 0 0"/>
    <axis xyz="0 0 1"/>
    <limit lower="${-pi/3}" upper="${pi/3}" effort="1.0" velocity="5.24"/>
  </joint>
  
  <!-- IR Left Sensor -->
  <link name="ir_left">
    <inertial>
      <mass value="0.005"/>
      <origin xyz="0 0 0"/>
      <inertia ixx="0.0000001" ixy="0.0" ixz="0.0" iyy="0.0000001" iyz="0.0" izz="0.0000001"/>
    </inertial>
    
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <sphere radius="0.008"/>
      </geometry>
      <material name="ir_color">
        <color rgba="0.9 0.3 0.3 1.0"/>
      </material>
    </visual>
  </link>
  
  <!-- IR Left Sensor Joint -->
  <joint name="ir_left_joint" type="fixed">
    <parent link="base_link"/>
    <child link="ir_left"/>
    <origin xyz="0.080 0.035 0.08" rpy="0 0 0"/>
  </joint>
  
  <!-- IR Right Sensor -->
  <link name="ir_right">
    <inertial>
      <mass value="0.005"/>
      <origin xyz="0 0 0"/>
      <inertia ixx="0.0000001" ixy="0.0" ixz="0.0" iyy="0.0000001" iyz="0.0" izz="0.0000001"/>
    </inertial>
    
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <sphere radius="0.008"/>
      </geometry>
      <material name="ir_color">
        <color rgba="0.9 0.3 0.3 1.0"/>
      </material>
    </visual>
  </link>
  
  <!-- IR Right Sensor Joint -->
  <joint name="ir_right_joint" type="fixed">
    <parent link="base_link"/>
    <child link="ir_right"/>
    <origin xyz="0.080 -0.035 0.08" rpy="0 0 0"/>
  </joint>
  
  <!-- Camera (Pi Camera or USB) -->
  <link name="camera">
    <inertial>
      <mass value="0.050"/>
      <origin xyz="0 0 0"/>
      <inertia ixx="0.00001" ixy="0.0" ixz="0.0" iyy="0.00001" iyz="0.0" izz="0.00001"/>
    </inertial>
    
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <box size="0.032 0.032 0.025"/>
      </geometry>
    </collision>
    
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <box size="0.032 0.032 0.025"/>
      </geometry>
      <material name="camera_color">
        <color rgba="0.1 0.1 0.1 1.0"/>
      </material>
    </visual>
  </link>
  
  <!-- Camera Joint -->
  <joint name="camera_joint" type="fixed">
    <parent link="base_link"/>
    <child link="camera"/>
    <origin xyz="0.075 0 0.09" rpy="0 0.2 0"/>
  </joint>
  
  <!-- MPU-6050 IMU -->
  <link name="imu">
    <inertial>
      <mass value="0.008"/>
      <origin xyz="0 0 0"/>
      <inertia ixx="0.000001" ixy="0.0" ixz="0.0" iyy="0.000001" iyz="0.0" izz="0.000001"/>
    </inertial>
    
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <box size="0.016 0.016 0.010"/>
      </geometry>
      <material name="imu_color">
        <color rgba="0.3 0.6 0.9 1.0"/>
      </material>
    </visual>
  </link>
  
  <!-- IMU Joint -->
  <joint name="imu_joint" type="fixed">
    <parent link="base_link"/>
    <child link="imu"/>
    <origin xyz="0.0 0.0 0.06" rpy="0 0 0"/>
  </joint>
  
  <!-- Raspberry Pi Board -->
  <link name="raspberry_pi">
    <inertial>
      <mass value="0.050"/>
      <origin xyz="0 0 0"/>
      <inertia ixx="0.00005" ixy="0.0" ixz="0.0" iyy="0.00005" iyz="0.0" izz="0.00008"/>
    </inertial>
    
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <box size="0.085 0.056 0.020"/>
      </geometry>
      <material name="rpi_color">
        <color rgba="0.7 0.3 0.0 1.0"/>
      </material>
    </visual>
  </link>
  
  <!-- Raspberry Pi Joint -->
  <joint name="raspberry_pi_joint" type="fixed">
    <parent link="base_link"/>
    <child link="raspberry_pi"/>
    <origin xyz="-0.005 0 0.065" rpy="0 0 0"/>
  </joint>
  
  <!-- ===== TRANSMISSIONS (Motor Control) ===== -->
  
  <!-- Front Left Motor Transmission -->
  <transmission name="wheel_front_left_transmission">
    <type>transmission_interface/SimpleTransmission</type>
    <joint name="wheel_front_left_joint">
      <hardwareInterface>hardware_interface/VelocityJointInterface</hardwareInterface>
    </joint>
    <actuator name="motor_front_left">
      <hardwareInterface>hardware_interface/VelocityJointInterface</hardwareInterface>
      <mechanicalReduction>30.0</mechanicalReduction>
    </actuator>
  </transmission>
  
  <!-- Front Right Motor Transmission -->
  <transmission name="wheel_front_right_transmission">
    <type>transmission_interface/SimpleTransmission</type>
    <joint name="wheel_front_right_joint">
      <hardwareInterface>hardware_interface/VelocityJointInterface</hardwareInterface>
    </joint>
    <actuator name="motor_front_right">
      <hardwareInterface>hardware_interface/VelocityJointInterface</hardwareInterface>
      <mechanicalReduction>30.0</mechanicalReduction>
    </actuator>
  </transmission>
  
  <!-- Rear Left Motor Transmission -->
  <transmission name="wheel_rear_left_transmission">
    <type>transmission_interface/SimpleTransmission</type>
    <joint name="wheel_rear_left_joint">
      <hardwareInterface>hardware_interface/VelocityJointInterface</hardwareInterface>
    </joint>
    <actuator name="motor_rear_left">
      <hardwareInterface>hardware_interface/VelocityJointInterface</hardwareInterface>
      <mechanicalReduction>30.0</mechanicalReduction>
    </actuator>
  </transmission>
  
  <!-- Rear Right Motor Transmission -->
  <transmission name="wheel_rear_right_transmission">
    <type>transmission_interface/SimpleTransmission</type>
    <joint name="wheel_rear_right_joint">
      <hardwareInterface>hardware_interface/VelocityJointInterface</hardwareInterface>
    </joint>
    <actuator name="motor_rear_right">
      <hardwareInterface>hardware_interface/VelocityJointInterface</hardwareInterface>
      <mechanicalReduction>30.0</mechanicalReduction>
    </actuator>
  </transmission>
  
</robot>
